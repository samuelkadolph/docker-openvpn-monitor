before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - docker version
  - export

env:
  global:
  - secure: iX0BkkPrjVeCZ1fFBqKn6kIy1wK9q6vaLzWYGAhrAFjbvGLk402t01lPATjpz9fLiyaC4sotL+ZiZM6NSIjQ0SnLde8kaVdRIpd4WDOUzFLu8HdSZSriiCvNd4jcyvJ72XEICgyCAPKZBiweDQ49OXQRFrOSmmmuGQm3p1+Dkq0LD10d5t2T4nIp11rSFudcVjkyNruzAfIVj6ApzqMxIceHB1WRSBV/PtmCcoZyTzd2jilpYptv39f0up21IclCo+QN1TZeV24jbBoVUr6O4rOJ4pkeL50kBL+PMhCUuqUG0LdOCj5DbZs32Z3hfrptgFZIz7Me0SAAXd4DfiadyMMrBUywYcpH2ZuKsZgHTmYRUlJ998Dssy3iaSNCFXvJctARhu/mwtngZLFRJ/jNXtOUQCJlSLfs2Ngu81Qi3inGJpGvH/XJF3VcA0rv4wxAigPJ6rk2UNEANVAEh9s3Y6DLK0hQs0tbFahRMQsNZm37tLumbd/y5K2KpCWuau2cLyEVa8jhga6qHw6vejftEM4v1IPlmPdHeXcMZebTrYoYXQfF8EpoKm12xEyLxsMDtceYPp9/BTP+Zka9hG519K8hf7Uo8YUfD59hrMsTzBULuk5d++6QSXkijxWjXzZM68tLyJH0+Q+nCkOIbPwE9aA1mOYO8e2pwfDgy9OAFQY=
  - DOCKER_BUILDKIT=1

services:
  - docker

script:
  - make build
  - docker run --detach --name openvpn-monitor --publish 8080:80 samuelkadolph/openvpn-monitor
  - sleep 3
  - curl http://localhost:8080 | grep "Example OpenVPN Status Monitor"
  - docker kill openvpn-monitor
